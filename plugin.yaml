name: app-typescript-openapi-plugin
description: Plugin que aplica o conceito de contract first a partir de um contrato OpenAPI e gera todo o código fonte e infraestrutura necessários em CDK.
types:
  - app
inputs:
  - label: Define o nome da API, também utilizado para fazer o link de códigos gerados e referências de código.
    type: text
    name: api_name
    default: api-name
    required: true
  - label: Define o nome do arquivo de especificação OpenAPI localizado no diretório /spec, por padrão é spec-file-name.
    global: true
    type: text
    name: spec_file_name
    default: spec-file-name
    required: false
  - label: Define o caminho, a partir da raiz do projeto, dos arquivos OpenAPI lambda gerados, por padrão é src.
    type: text
    name: source_dir
    default: src
    required: false
  # - label: A maioria dos provvedores IDM expõem uma 'JWKS_URI' com suas chaves públicas para verificar assinaturas JWT. Necessário definir essa entrada para informar a 'JWKS_URI' utilizada para resgatar as chaves públicas.
  #   type: text
  #   name: jwks_uri
  #   required: false
  # - label: Identificação se deve ou não virtualizar o API Gateway (True/False), por padrão é True
  #   type: bool
  #   name: virtualize_gateway
  #   default: false
  #   required: false
  # - label: Caso o contrato definido nesse plugin já esteja exposto no API Gateway, esse campo deve informar os pontos de entrada de cada ambiente (ex. dev, qa, prod), se não for informado, uma implementação API Gateway com CDK Implementation será gerada.
  #   type: multiselect
  #   name: gateway_entry_points
  #   items:
  #     - item1
  #     - item2
  #   required: false
  - label: Define a utilização de Access-Control-Allow-Origin customizado dos endpoints. Por padrão é "*"
    type: text
    name: access_control_allow_origin
    default: "*"
    required: false
  - label: Define a utilização de Access-Control-Allow-Headers customizado dos endpoints. Por padrão é "*"
    type: text
    name: access_control_allow_headers
    default: "*"
    required: false
  - label: Define a utilização de Access-Control-Allow-Methods customizado dos endpoints. Por padrão é "*"
    type: text
    name: access_control_allow_methods
    default: "*"
    required: false
  - label: Define a utilização de Access-Control-Allow-Credentials customizado dos endpoints. Por padrão é "*"
    type: text
    name: access_control_allow_credentials
    default: "*"
    required: false
hooks:
  - type: edit
    trigger: before-render
    path: infra/lib/{{service_name}}-service-stack.ts
    changes:
      - search:
          string: import * as cdk from '@aws-cdk/core'
          insert-after:
            snippet: snippets/typescript-openapi-service-import.txt
          when:
            not-exists: import { StackSpotOpenApiServices } from "@stackspot/cdk-component-openapi-typescript"
  - type: edit
    trigger: before-render
    path: infra/lib/{{service_name}}-service-stack.ts
    changes:
      - search:
          string: "super(scope, id, props);"
          insert-after:
            snippet: snippets/typescript-openapi-service-constructor.txt
          when:
            not-exists: new StackSpotOpenApiServices(this, "StackSpotOpenApiServices", {
  - type: edit
    trigger: before-render
    path: package.json
    changes:
      - search:
          string: "scripts"
          insert-after:
            snippet: snippets/package-json-scripts.txt
          when:
            not-exists: "source:setup:openapi"
  - type: run
    trigger: after-render
    mac:
      - npm run infra:install:openapi
      - npm run infra:format:fix
      - npm run infra:build:cdk
      - npm run source:setup:openapi
    linux:
      - npm run infra:install:openapi
      - npm run infra:format:fix
      - npm run infra:build:cdk
      - npm run source:setup:openapi
    windows:
      - npm.cmd run infra:install:openapi
      - npm.cmd run infra:format:fix
      - npm.cmd run infra:build:cdk
      - npm.cmd run source:setup:openapi

displayName: OpenAPI + API Gateway Plugin

category: Backend

compatibility:
  - OpenAPI 3.0
  - NodeJS 14.x

about: about.md

usage: usage.md

useCase: useCase.md

implementation: implementation.md

technologies: [ "Typescript", "OpenAPI", "API Gateway" ]
